<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPstudio</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入CodeMirror用于代码编辑 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-family: sans-serif;
        }
        
        /* F9白色界面样式 */
        #white-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 9999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            flex-direction: row;
        }
        
        #white-screen.active {
            display: flex;
            opacity: 1;
        }
        
        /* 白色页面侧边栏 */
        #white-sidebar {
            width: 60px;
            height: 100%;
            background-color: #f5f5f5;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }
        
        .white-sidebar-btn {
            width: 40px;
            height: 40px;
            border: none;
            background-color: transparent;
            border-radius: 6px;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .white-sidebar-btn:hover, .white-sidebar-btn.active {
            background-color: #e9e9e9;
            color: #2c3e50;
        }
        
        .white-sidebar-btn i {
            pointer-events: none;
        }
        
        /* 内容区域样式 */
        #white-content {
            flex: 1;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .content-section {
            display: none;
            height: 100%;
            flex-direction: column;
        }
        
        .content-section.active {
            display: flex;
        }
        
        .section-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            margin: 0;
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }
        
        .section-actions {
            display: flex;
            gap: 10px;
        }
        
        .content-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .content-btn:hover {
            background-color: #f5f5f5;
            border-color: #ccc;
        }
        
        .content-btn.primary {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .content-btn.primary:hover {
            background-color: #2980b9;
        }
        
        /* 构建按钮样式 */
        .build-btn {
            background-color: #9b59b6;
            color: white;
            border-color: #8e44ad;
        }
        
        .build-btn:hover {
            background-color: #8e44ad;
        }
        
        .content-body {
            flex: 1;
            overflow: auto;
            padding: 20px;
        }
        
        /* 代码编辑区域样式 */
        .code-editor {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .code-container {
            flex: 1;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .code-header {
            padding: 8px 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-header-actions {
            display: flex;
            gap: 8px;
        }
        
        .code-header-btn {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 2px;
            border: 1px solid #ddd;
            background-color: #fff;
            cursor: pointer;
        }
        
        .code-content {
            flex: 1;
            overflow: auto;
            position: relative;
        }
        
        textarea.code-input {
            width: 100%;
            height: 100%;
            border: none;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
            line-height: 1.5;
        }
        
        textarea.code-input:focus {
            outline: none;
        }
        
        /* 控件代码编辑区域样式 */
        .controls-editor {
            max-width: 800px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .html-editor-container {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .editor-toolbar {
            padding: 10px 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-toolbar-group {
            display: flex;
            gap: 8px;
        }
        
        .editor-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background-color: #fff;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .editor-btn:hover {
            background-color: #f0f0f0;
        }
        
        .editor-btn.primary {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        
        .editor-btn.primary:hover {
            background-color: #2980b9;
        }
        
        .html-editor {
            flex: 1;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            padding: 15px;
            border: none;
            width: 100%;
            box-sizing: border-box;
            resize: none;
            line-height: 1.5;
        }
        
        .html-editor:focus {
            outline: none;
        }
        
        /* JavaScript编辑器样式 */
        .js-editor-container {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .js-editor {
            flex: 1;
            width: 100%;
        }
        
        /* 移除控制台相关样式 */
        .js-console {
            display: none;
        }
        
        /* 占位内容样式 */
        .placeholder-content {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }
        
        /* 左侧控件库侧边栏样式 */
        #left-sidebar {
            width: 220px;
            background-color: #f0f0f0;
            border-right: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            transition: width 0.3s ease, padding 0.3s ease, border-right 0.3s ease;
            z-index: 100;
        }
        
        /* 右侧属性面板侧边栏样式 */
        #right-sidebar {
            width: 350px;
            background-color: #f8f8f8;
            border-left: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            transition: width 0.3s ease;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        /* 两侧边栏折叠状态 */
        body.sidebars-collapsed #left-sidebar {
            width: 0;
            padding: 0;
            border-right: none;
            overflow: hidden;
        }
        
        body.sidebars-collapsed #right-sidebar {
            width: 0;
            padding: 0;
            border-left: none;
            overflow: hidden;
        }
        
        /* 左侧侧边栏折叠时隐藏文本内容 */
        body.sidebars-collapsed #left-sidebar .label,
        body.sidebars-collapsed #left-sidebar .group-title,
        body.sidebars-collapsed #left-sidebar .sidebar-header,
        body.sidebars-collapsed #left-sidebar .sidebar-hint {
            display: none;
        }
        
        /* 左侧控件库样式 */
        .sidebar-header {
            padding: 10px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            font-size: 15px;
            font-weight: bold;
        }
        
        .sidebar-hint {
            font-size: 11px;
            color: #666;
            margin-top: 10px;
            text-align: center;
            padding: 5px 0;
            border-top: 1px solid #eee;
        }
        
        .control-item {
            padding: 7px 10px;
            margin: 4px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: move;
            display: flex;
            align-items: center;
            font-size: 13px;
            background-color: white;
            transition: all 0.2s;
        }
        
        .control-item i {
            width: 20px;
            text-align: center;
            margin-right: 10px;
            color: #555;
        }
        
        .control-item:hover {
            background-color: #f5f5f5;
            border-color: #ccc;
        }
        
        .control-item.dragging {
            opacity: 0.7;
            background-color: #e9e9e9;
        }
        
        .control-group {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .group-title {
            font-size: 13px;
            color: #333;
            margin: 10px 0 6px 0;
            font-weight: bold;
            padding-left: 4px;
        }
        
        /* 编辑区域样式 */
        #editor {
            flex: 1;
            overflow: auto;
            position: relative;
            background-color: #fff;
            background-image: 
                linear-gradient(#eee 1px, transparent 1px),
                linear-gradient(90deg, #eee 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        #drop-area {
            width: 100%;
            height: 100%;
            min-height: 100vh;
            position: relative;
        }
        
        #drop-area.highlight {
            background-color: rgba(220, 220, 220, 0.1);
        }
        
        /* 可拖拽元素样式 */
        [data-draggable="true"] {
            position: absolute;
            cursor: move;
            user-select: none;
            transition: opacity 0.2s, outline 0.2s;
            z-index: 10;
        }
        
        [data-draggable="true"].selected {
            outline: 2px solid #4a86e8;
            outline-offset: 2px;
            opacity: 0.95;
            box-shadow: 0 0 0 2px rgba(74, 134, 232, 0.2);
        }
        
        [data-draggable="true"].dragging {
            opacity: 0.8;
            cursor: grabbing;
        }
        
        /* 移动时禁用内部元素交互 */
        [data-draggable="true"].dragging * {
            pointer-events: none !important;
        }
        
        /* 初始提示 */
        .initial-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            font-size: 14px;
            text-align: center;
            max-width: 300px;
        }
        
        /* 右侧属性面板样式 */
        .property-header {
            padding: 10px 0;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .property-title {
            margin: 0;
            font-size: 15px;
            font-weight: bold;
            color: #333;
        }
        
        .property-content {
            display: none;
        }
        
        .property-empty {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #999;
            font-size: 13px;
            text-align: center;
            padding: 20px;
        }
        
        .property-empty i {
            font-size: 24px;
            margin-bottom: 10px;
            color: #ccc;
        }
        
        .property-group {
            margin-bottom: 20px;
        }
        
        .property-group-title {
            font-size: 13px;
            color: #666;
            margin: 0 0 8px 0;
            padding-left: 4px;
            border-left: 3px solid #4a86e8;
        }
        
        .property-item {
            margin-bottom: 12px;
        }
        
        .property-label {
            display: block;
            font-size: 12px;
            color: #555;
            margin-bottom: 4px;
        }
        
        .property-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
            box-sizing: border-box;
        }
        
        .property-input:focus {
            outline: none;
            border-color: #4a86e8;
            box-shadow: 0 0 0 2px rgba(74, 134, 232, 0.2);
        }
        
        /* 代码显示与编辑区域 */
        .code-editor-small {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .code-editor-header {
            padding: 5px 10px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
            color: #666;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .code-editor-content {
            position: relative;
        }
        
        .code-input-small {
            width: 100%;
            min-height: 100px;
            max-height: 200px;
            border: none;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            resize: vertical;
            box-sizing: border-box;
            line-height: 1.5;
        }
        
        .code-input-small:focus {
            outline: none;
        }
        
        .code-error {
            color: #e74c3c;
            font-size: 12px;
            padding: 5px 10px;
            background-color: #fdf2f2;
            border-top: 1px solid #fce8e6;
            display: none;
        }
        
        .code-error.active {
            display: block;
        }
        
        .property-actions {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
        }
        
        .property-btn {
            flex: 1;
            padding: 7px 0;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.2s;
        }
        
        .btn-apply {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-apply:hover {
            background-color: #27ae60;
        }
        
        .btn-copy {
            background-color: #3498db;
            color: white;
        }
        
        .btn-copy:hover {
            background-color: #2980b9;
        }
        
        /* 所有元素代码汇总区域 */
        .all-elements-code {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        
        .code-summary-title {
            font-size: 13px;
            color: #666;
            margin: 0 0 8px 0;
            font-weight: 600;
        }
        
        .code-display {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            padding: 10px;
            box-sizing: border-box;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.5;
            min-height: 100px;
            border: 1px solid #ddd;
        }

        /* 总结构相关样式 */
        .structure-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .structure-toolbar {
            padding: 15px 20px;
            background-color: #f9f9f9;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .structure-title {
            margin: 0;
            font-size: 18px;
            color: #333;
            font-weight: 600;
        }
        
        .toolbar-actions {
            display: flex;
            gap: 10px;
        }
        
        .add-block-btn {
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }
        
        .add-block-btn:hover {
            background-color: #2980b9;
        }
        
        .blocks-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: #f9f9f9;
        }
        
        .structure-block {
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .structure-block-header {
            padding: 10px 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .structure-block-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .structure-block-actions {
            display: flex;
            gap: 5px;
        }
        
        .block-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: none;
            border-radius: 3px;
            cursor: pointer;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .block-action-btn:hover {
            background-color: #e9e9e9;
            color: #333;
        }
        
        .structure-block-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .structure-block.expanded .structure-block-content {
            padding: 15px;
            max-height: 500px;
        }
        
        /* 块类型选择弹窗 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background-color: white;
            border-radius: 6px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .block-type-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .block-type-item {
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .block-type-item:hover {
            background-color: #f5f5f5;
            border-color: #ccc;
        }
        
        .block-type-icon {
            width: 24px;
            height: 24px;
            background-color: #f0f0f0;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #3498db;
        }
        
        .block-type-name {
            font-size: 14px;
            font-weight: 500;
        }
        
        .block-type-desc {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
        }
        
        /* 构建结果弹窗 */
        #build-result-modal .modal-body {
            padding: 15px 20px;
        }
        
        .filename-input-group {
            margin-bottom: 15px;
        }
        
        .filename-label {
            display: block;
            font-size: 14px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .filename-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        .build-result-code {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            padding: 10px;
            box-sizing: border-box;
            resize: none;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .build-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .build-action-btn {
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .cancel-btn {
            background-color: #fff;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .cancel-btn:hover {
            background-color: #f5f5f5;
        }
        
        .download-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
        }
        
        .download-btn:hover {
            background-color: #27ae60;
        }
    </style>
</head>
<body>
    <!-- F9白色覆盖页面 -->
    <div id="white-screen">
        <!-- 白色页面侧边栏 -->
        <div id="white-sidebar">
            <button class="white-sidebar-btn" id="style-btn" title="样式表">
                <i class="fa fa-css3"></i>
            </button>
            <button class="white-sidebar-btn" id="controls-btn" title="控件">
                <i class="fa fa-th-large"></i>
            </button>
            <button class="white-sidebar-btn" id="structure-btn" title="总结构">
                <i class="fa fa-sitemap"></i>
            </button>
            <button class="white-sidebar-btn" id="js-btn" title="JavaScript">
                <i class="fa fa-code"></i>
            </button>
        </div>
        
        <!-- 白色页面主内容区 -->
        <div id="white-content">
            <!-- 样式表编辑区域 -->
            <div class="content-section" id="style-section">
                <div class="section-header">
                    <h2 class="section-title">样式表编辑</h2>
                    <div class="section-actions">
                        <button class="content-btn" id="reset-css-btn">
                            <i class="fa fa-refresh"></i> 重置
                        </button>
                        <button class="content-btn primary" id="apply-css-btn">
                            <i class="fa fa-check"></i> 应用
                        </button>
                    </div>
                </div>
                <div class="content-body">
                    <div class="code-editor">
                        <div class="code-container">
                            <div class="code-header">
                                <span>styles.css (标准CSS格式)</span>
                            </div>
                            <div class="code-content">
                                <textarea class="code-input" id="css-editor" spellcheck="false" placeholder="/* 在这里输入标准CSS样式代码 */
/* 示例:
body {
    font-family: Arial, sans-serif;
}

h1 {
    color: #333;
    font-size: 24px;
}
*/"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 控件代码编辑区域 -->
            <div class="content-section" id="controls-section">
                <div class="section-header">
                    <h2 class="section-title">所有元素HTML代码（可编辑）</h2>
                    <div class="section-actions">
                        <button class="content-btn" id="reset-html-btn">
                            <i class="fa fa-refresh"></i> 重置
                        </button>
                        <button class="content-btn primary" id="copy-html-btn">
                            <i class="fa fa-copy"></i> 复制代码
                        </button>
                        <button class="content-btn primary" id="apply-all-html-btn">
                            <i class="fa fa-check"></i> 应用全部
                        </button>
                    </div>
                </div>
                <div class="content-body">
                    <div class="controls-editor">
                        <div class="html-editor-container">
                            <div class="editor-toolbar">
                                <div class="editor-toolbar-group">
                                    <button class="editor-btn" id="add-h1">
                                        <i class="fa fa-header"></i> H1
                                    </button>
                                    <button class="editor-btn" id="add-h2">
                                        <i class="fa fa-header"></i> H2
                                    </button>
                                    <button class="editor-btn" id="add-p">
                                        <i class="fa fa-paragraph"></i> 段落
                                    </button>
                                    <button class="editor-btn" id="add-input">
                                        <i class="fa fa-font"></i> 输入框
                                    </button>
                                    <button class="editor-btn" id="add-button">
                                        <i class="fa fa-square"></i> 按钮
                                    </button>
                                </div>
                            </div>
                            <textarea class="html-editor" id="html-editor" spellcheck="false" placeholder="所有页面元素的HTML代码将显示在这里，编辑后点击"应用全部"按钮更新页面"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 总结构区域 -->
            <div class="content-section" id="structure-section">
                <div class="structure-container">
                    <div class="structure-toolbar">
                        <h2 class="structure-title">总结构</h2>
                        <div class="toolbar-actions">
                            <button class="add-block-btn" id="add-structure-block">
                                <i class="fa fa-plus"></i> 添加块
                            </button>
                            <button class="add-block-btn build-btn" id="build-project-btn">
                                <i class="fa fa-cogs"></i> 构建
                            </button>
                        </div>
                    </div>
                    <div class="blocks-container" id="structure-blocks-container">
                        <!-- 块将通过JavaScript动态添加到这里 -->
                    </div>
                </div>
            </div>
            
            <!-- JavaScript编辑区域 -->
            <div class="content-section" id="js-section">
                <div class="section-header">
                    <h2 class="section-title">JavaScript编辑</h2>
                    <div class="section-actions">
                        <button class="content-btn" id="reset-js-btn">
                            <i class="fa fa-refresh"></i> 重置
                        </button>
                        <button class="content-btn primary" id="save-js-btn">
                            <i class="fa fa-save"></i> 保存
                        </button>
                        <button class="content-btn primary" id="copy-js-btn">
                            <i class="fa fa-copy"></i> 复制
                        </button>
                    </div>
                </div>
                <div class="content-body">
                    <div class="js-editor-container">
                        <div class="editor-toolbar">
                            <div class="editor-toolbar-group">
                                <button class="editor-btn" id="insert-log">
                                    <i class="fa fa-terminal"></i> console.log()
                                </button>
                                <button class="editor-btn" id="insert-function">
                                    <i class="fa fa-code"></i> 函数
                                </button>
                                <button class="editor-btn" id="insert-event">
                                    <i class="fa fa-exclamation-circle"></i> 事件监听
                                </button>
                            </div>
                        </div>
                        <div class="js-editor" id="js-editor-container">
                            <textarea id="js-editor-textarea" spellcheck="false" placeholder="在此处编写JavaScript代码，代码不会被执行，仅用于编辑和保存"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 构建结果弹窗 -->
    <div class="modal-overlay" id="build-result-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">构建结果</h3>
                <button class="modal-close" id="build-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="filename-input-group">
                    <label class="filename-label" for="filename-input">文件名:</label>
                    <input type="text" id="filename-input" class="filename-input" placeholder="输入文件名（默认使用时间戳）">
                </div>
                <textarea class="build-result-code" id="build-result-code" readonly></textarea>
                <div class="build-actions">
                    <button class="build-action-btn cancel-btn" id="build-cancel-btn">取消</button>
                    <button class="build-action-btn download-btn" id="download-build-btn">下载HTML文件</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 块类型选择弹窗 -->
    <div class="modal-overlay" id="block-type-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">选择块类型</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <ul class="block-type-list">
                    <li class="block-type-item" data-type="code">
                        <div class="block-type-icon">
                            <i class="fa fa-code"></i>
                        </div>
                        <div>
                            <div class="block-type-name">代码</div>
                            <div class="block-type-desc">自定义代码块，可直接编辑内容</div>
                        </div>
                    </li>
                    <li class="block-type-item" data-type="stylesheet">
                        <div class="block-type-icon">
                            <i class="fa fa-css3"></i>
                        </div>
                        <div>
                            <div class="block-type-name">样式表</div>
                            <div class="block-type-desc">与样式表编辑器同步的CSS代码</div>
                        </div>
                    </li>
                    <li class="block-type-item" data-type="controls">
                        <div class="block-type-icon">
                            <i class="fa fa-th-large"></i>
                        </div>
                        <div>
                            <div class="block-type-name">控件块</div>
                            <div class="block-type-desc">与控件编辑器同步的HTML代码</div>
                        </div>
                    </li>
                    <li class="block-type-item" data-type="js">
                        <div class="block-type-icon">
                            <i class="fa fa-code"></i>
                        </div>
                        <div>
                            <div class="block-type-name">JS</div>
                            <div class="block-type-desc">与JavaScript编辑器同步的代码</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- 左侧控件库侧边栏 -->
    <div id="left-sidebar">
        <div class="sidebar-header">纯独立控件库</div>
        
        <!-- 标题标签 -->
        <div class="control-group">
            <div class="group-title">标题标签</div>
            <div class="control-item" draggable="true" data-type="h1">
                <i class="fa fa-header"></i>
                <span class="label">H1 大标题</span>
            </div>
            <div class="control-item" draggable="true" data-type="h2">
                <i class="fa fa-header"></i>
                <span class="label">H2 二级标题</span>
            </div>
            <div class="control-item" draggable="true" data-type="h3">
                <i class="fa fa-header"></i>
                <span class="label">H3 三级标题</span>
            </div>
        </div>
        
        <!-- 块级文本容器 -->
        <div class="control-group">
            <div class="group-title">块级文本容器</div>
            <div class="control-item" draggable="true" data-type="p">
                <i class="fa fa-align-left"></i>
                <span class="label">段落 (p)</span>
            </div>
            <div class="control-item" draggable="true" data-type="blockquote">
                <i class="fa fa-quote-right"></i>
                <span class="label">引用块</span>
            </div>
        </div>
        
        <!-- 按钮控件 -->
        <div class="control-group">
            <div class="group-title">按钮控件</div>
            <div class="control-item" draggable="true" data-type="button">
                <i class="fa fa-square"></i>
                <span class="label">普通按钮</span>
            </div>
            <div class="control-item" draggable="true" data-type="button-submit">
                <i class="fa fa-check"></i>
                <span class="label">提交按钮</span>
            </div>
        </div>
        
        <!-- 输入控件 -->
        <div class="control-group">
            <div class="group-title">输入控件</div>
            <div class="control-item" draggable="true" data-type="input-text">
                <i class="fa fa-font"></i>
                <span class="label">文本输入框</span>
            </div>
            <div class="control-item" draggable="true" data-type="input-password">
                <i class="fa fa-lock"></i>
                <span class="label">密码框</span>
            </div>
            <div class="control-item" draggable="true" data-type="input-date">
                <i class="fa fa-calendar"></i>
                <span class="label">日期选择框</span>
            </div>
        </div>
        
        <!-- 基础选择控件 -->
        <div class="control-group">
            <div class="group-title">选择控件</div>
            <div class="control-item" draggable="true" data-type="select">
                <i class="fa fa-list"></i>
                <span class="label">下拉菜单</span>
            </div>
        </div>
        
        <!-- 文本区域 -->
        <div class="control-group">
            <div class="group-title">文本区域</div>
            <div class="control-item" draggable="true" data-type="textarea">
                <i class="fa fa-align-justify"></i>
                <span class="label">文本域</span>
            </div>
            <div class="control-item" draggable="true" data-type="label">
                <i class="fa fa-tag"></i>
                <span class="label">标签</span>
            </div>
        </div>
        
        <!-- 媒体元素 -->
        <div class="control-group">
            <div class="group-title">媒体元素</div>
            <div class="control-item" draggable="true" data-type="img">
                <i class="fa fa-image"></i>
                <span class="label">图片</span>
            </div>
            <div class="control-item" draggable="true" data-type="video">
                <i class="fa fa-film"></i>
                <span class="label">视频</span>
            </div>
            <div class="control-item" draggable="true" data-type="audio">
                <i class="fa fa-music"></i>
                <span class="label">音频</span>
            </div>
        </div>
        
        <div class="sidebar-hint">按F8显示或隐藏侧边栏<br>按F9切换代码界面<br>选中元素可编辑代码</div>
    </div>
    
    <!-- 编辑区域 -->
    <div id="editor">
        <div id="drop-area">
            <div class="initial-hint">从左侧拖拽独立控件到此处<br>点击元素选中后可在右侧编辑代码<br>编辑代码将实时反映到页面元素<br>按F8切换侧边栏显示/隐藏<br>按F9切换代码界面</div>
        </div>
    </div>
    
    <!-- 右侧属性面板侧边栏 -->
    <div id="right-sidebar">
        <div class="property-header">
            <h3 class="property-title">元素属性与代码编辑</h3>
        </div>
        
        <!-- 未选中元素时显示 -->
        <div class="property-empty">
            <i class="fa fa-hand-pointer-o"></i>
            <p>请在编辑区点击选择一个元素<br>以查看和编辑其属性及HTML代码</p>
        </div>
        
        <!-- 选中元素时显示（默认隐藏） -->
        <div class="property-content">
            <div class="property-group">
                <h4 class="property-group-title">位置信息</h4>
                <div class="property-item">
                    <label class="property-label" for="pos-x">X 坐标 (px)</label>
                    <input type="number" id="pos-x" class="property-input" min="0">
                </div>
                <div class="property-item">
                    <label class="property-label" for="pos-y">Y 坐标 (px)</label>
                    <input type="number" id="pos-y" class="property-input" min="0">
                </div>
            </div>
            
            <div class="property-group">
                <h4 class="property-group-title">元素信息</h4>
                <div class="property-item">
                    <label class="property-label" for="element-type">元素类型</label>
                    <input type="text" id="element-type" class="property-input" readonly>
                </div>
            </div>
            
            <div class="property-group">
                <h4 class="property-group-title">HTML代码编辑（包含位置）</h4>
                <div class="code-editor-small">
                    <div class="code-editor-header">
                        <span>编辑代码将实时更新元素</span>
                    </div>
                    <div class="code-editor-content">
                        <textarea class="code-input-small" id="element-code-editor"></textarea>
                        <div class="code-error" id="code-error"></div>
                    </div>
                </div>
            </div>
            
            <div class="property-actions">
                <button id="apply-element-code" class="property-btn btn-apply">
                    <i class="fa fa-check"></i> 应用修改
                </button>
                <button id="copy-element-code" class="property-btn btn-copy">
                    <i class="fa fa-copy"></i> 复制代码
                </button>
            </div>
            
            <!-- 所有元素代码汇总 -->
            <div class="all-elements-code">
                <div class="code-summary-title">所有元素代码汇总</div>
                <div class="code-display" id="all-elements-code-display"></div>
            </div>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const leftSidebar = document.getElementById('left-sidebar');
        const rightSidebar = document.getElementById('right-sidebar');
        const dropArea = document.getElementById('drop-area');
        const controlItems = document.querySelectorAll('.control-item');
        const propertyEmpty = document.querySelector('.property-empty');
        const propertyContent = document.querySelector('.property-content');
        const posXInput = document.getElementById('pos-x');
        const posYInput = document.getElementById('pos-y');
        const elementTypeInput = document.getElementById('element-type');
        const elementCodeEditor = document.getElementById('element-code-editor');
        const codeError = document.getElementById('code-error');
        const applyElementCodeBtn = document.getElementById('apply-element-code');
        const copyElementCodeBtn = document.getElementById('copy-element-code');
        const allElementsCodeDisplay = document.getElementById('all-elements-code-display');
        const whiteScreen = document.getElementById('white-screen');
        const whiteSidebar = document.getElementById('white-sidebar');
        const styleBtn = document.getElementById('style-btn');
        const controlsBtn = document.getElementById('controls-btn');
        const structureBtn = document.getElementById('structure-btn');
        const jsBtn = document.getElementById('js-btn');
        const contentSections = document.querySelectorAll('.content-section');
        const cssEditor = document.getElementById('css-editor');
        const resetCssBtn = document.getElementById('reset-css-btn');
        const applyCssBtn = document.getElementById('apply-css-btn');
        const htmlEditor = document.getElementById('html-editor');
        const resetHtmlBtn = document.getElementById('reset-html-btn');
        const copyHtmlBtn = document.getElementById('copy-html-btn');
        const applyAllHtmlBtn = document.getElementById('apply-all-html-btn');
        
        // JavaScript编辑器相关元素
        const jsEditorTextarea = document.getElementById('js-editor-textarea');
        const jsEditorContainer = document.getElementById('js-editor-container');
        const resetJsBtn = document.getElementById('reset-js-btn');
        const saveJsBtn = document.getElementById('save-js-btn');
        const copyJsBtn = document.getElementById('copy-js-btn');
        const insertLogBtn = document.getElementById('insert-log');
        const insertFunctionBtn = document.getElementById('insert-function');
        const insertEventBtn = document.getElementById('insert-event');
        
        // 快捷添加按钮
        const addH1Btn = document.getElementById('add-h1');
        const addH2Btn = document.getElementById('add-h2');
        const addPBtn = document.getElementById('add-p');
        const addInputBtn = document.getElementById('add-input');
        const addButtonBtn = document.getElementById('add-button');
        
        // 总结构相关元素
        const addStructureBlockBtn = document.getElementById('add-structure-block');
        const buildProjectBtn = document.getElementById('build-project-btn');
        const structureBlocksContainer = document.getElementById('structure-blocks-container');
        const blockTypeModal = document.getElementById('block-type-modal');
        const modalCloseBtn = document.getElementById('modal-close');
        const blockTypeItems = document.querySelectorAll('.block-type-item');
        
        // 构建结果弹窗相关元素
        const buildResultModal = document.getElementById('build-result-modal');
        const buildModalCloseBtn = document.getElementById('build-modal-close');
        const filenameInput = document.getElementById('filename-input');
        const buildResultCode = document.getElementById('build-result-code');
        const buildCancelBtn = document.getElementById('build-cancel-btn');
        const downloadBuildBtn = document.getElementById('download-build-btn');
        
        // 存储所有添加的元素及其信息
        let addedElements = [];
        let elementCounter = 0;
        let jsEditor; // CodeMirror编辑器实例
        let structureBlocks = []; // 存储总结构中的块
        let structureBlockCounter = 0; // 块计数器
        
        // 状态变量
        let draggedItem = null;
        let activeElement = null;
        let selectedElement = null;
        let selectedElementInfo = null;
        let initialX, initialY;
        let offsetX = 0, offsetY = 0;
        let isDragging = false;
        let whiteScreenActive = false;
        
        // 初始化事件监听
        function initEventListeners() {
            // 左侧控件拖拽事件
            controlItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
            });
            
            // 放置区域事件
            dropArea.addEventListener('dragover', handleDragOver);
            dropArea.addEventListener('dragenter', handleDragEnter);
            dropArea.addEventListener('dragleave', handleDragLeave);
            dropArea.addEventListener('drop', handleDrop);
            dropArea.addEventListener('click', handleDropAreaClick);
            
            // 位置输入框事件
            posXInput.addEventListener('change', updateElementPosition);
            posYInput.addEventListener('change', updateElementPosition);
            
            // 属性面板按钮事件
            applyElementCodeBtn.addEventListener('click', applyElementCodeChanges);
            copyElementCodeBtn.addEventListener('click', copyElementCode);
            
            // 白色页面侧边栏按钮事件
            styleBtn.addEventListener('click', () => showSection('style-section', styleBtn));
            controlsBtn.addEventListener('click', () => showSection('controls-section', controlsBtn));
            structureBtn.addEventListener('click', () => showSection('structure-section', structureBtn));
            jsBtn.addEventListener('click', () => showSection('js-section', jsBtn));
            
            // 样式表编辑按钮事件
            resetCssBtn.addEventListener('click', resetCss);
            applyCssBtn.addEventListener('click', applyCss);
            
            // HTML编辑按钮事件
            resetHtmlBtn.addEventListener('click', resetHtml);
            copyHtmlBtn.addEventListener('click', copyHtmlCode);
            applyAllHtmlBtn.addEventListener('click', applyAllHtmlChanges);
            
            // 快捷添加按钮事件
            addH1Btn.addEventListener('click', () => addHtmlSnippet('<h1 style="position: absolute; left: 50px; top: 50px;">新的H1标题</h1>'));
            addH2Btn.addEventListener('click', () => addHtmlSnippet('<h2 style="position: absolute; left: 50px; top: 80px;">新的H2标题</h2>'));
            addPBtn.addEventListener('click', () => addHtmlSnippet('<p style="position: absolute; left: 50px; top: 110px;">新的段落内容。</p>'));
            addInputBtn.addEventListener('click', () => addHtmlSnippet('<input type="text" placeholder="新输入框" style="position: absolute; left: 50px; top: 140px;">'));
            addButtonBtn.addEventListener('click', () => addHtmlSnippet('<button style="position: absolute; left: 50px; top: 170px;">新按钮</button>'));
            
            // JavaScript编辑器按钮事件
            resetJsBtn.addEventListener('click', resetJavaScript);
            saveJsBtn.addEventListener('click', saveJavaScript);
            copyJsBtn.addEventListener('click', copyJavaScript);
            insertLogBtn.addEventListener('click', () => insertJavaScriptSnippet('console.log();'));
            insertFunctionBtn.addEventListener('click', () => insertJavaScriptSnippet('function myFunction() {\n    // 函数内容\n}'));
            insertEventBtn.addEventListener('click', () => insertJavaScriptSnippet('// 为元素添加事件监听\nconst element = document.querySelector("#elementId");\nif (element) {\n    element.addEventListener("click", function() {\n        // 事件处理逻辑\n    });\n}'));
            
            // 总结构相关事件
            addStructureBlockBtn.addEventListener('click', openBlockTypeModal);
            modalCloseBtn.addEventListener('click', closeBlockTypeModal);
            blockTypeItems.forEach(item => {
                item.addEventListener('click', () => {
                    const type = item.getAttribute('data-type');
                    addStructureBlock(type);
                    closeBlockTypeModal();
                });
            });
            
            // 构建按钮事件
            buildProjectBtn.addEventListener('click', buildProject);
            
            // 构建结果弹窗事件
            buildModalCloseBtn.addEventListener('click', closeBuildModal);
            buildCancelBtn.addEventListener('click', closeBuildModal);
            downloadBuildBtn.addEventListener('click', downloadBuildResult);
            
            // 点击模态框外部关闭
            blockTypeModal.addEventListener('click', (e) => {
                if (e.target === blockTypeModal) {
                    closeBlockTypeModal();
                }
            });
            
            buildResultModal.addEventListener('click', (e) => {
                if (e.target === buildResultModal) {
                    closeBuildModal();
                }
            });
            
            // 键盘事件
            document.addEventListener('keydown', handleKeyDown);
            
            // 为dropArea添加事件委托，处理内部元素的点击
            dropArea.addEventListener('click', function(e) {
                // 查找最近的可拖拽元素
                const draggableElement = e.target.closest('[data-draggable="true"]');
                if (draggableElement) {
                    e.stopPropagation();
                    selectElement(draggableElement);
                }
            });
        }
        
        // 初始化JavaScript编辑器
        function initJavaScriptEditor() {
            // 创建CodeMirror编辑器实例
            jsEditor = CodeMirror.fromTextArea(jsEditorTextarea, {
                mode: 'javascript',
                theme: 'dracula',
                lineNumbers: true,
                autoCloseTags: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                indentWithTabs: false,
                lineWrapping: true,
                extraKeys: {
                    "Ctrl-/": "toggleComment",
                    "Cmd-/": "toggleComment"
                },
                height: '100%',
                viewportMargin: Infinity
            });
            
            // 设置默认示例代码
            const defaultJsCode = `// 此编辑器仅用于编写和保存JavaScript代码
// 代码不会被执行，仅作为编辑工具使用

// 示例：为所有按钮添加点击事件
document.addEventListener('DOMContentLoaded', function() {
    // 这段代码不会被执行，仅用于编辑参考
    const buttons = document.querySelectorAll('button');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            console.log('按钮被点击:', this.textContent);
        });
    });
});

// 示例函数：更改元素颜色
function changeElementColor(elementId, color) {
    const element = document.querySelector('[data-id="' + elementId + '"]');
    if (element) {
        element.style.color = color;
        console.log('元素', elementId, '颜色已更改为:', color);
        return true;
    } else {
        console.error('未找到ID为', elementId, '的元素');
        return false;
    }
}`;
            
            jsEditor.setValue(defaultJsCode);
            
            // 尝试从本地存储加载代码
            const savedJsCode = localStorage.getItem('savedJSCode');
            if (savedJsCode) {
                jsEditor.setValue(savedJsCode);
            }
        }
        
        // 重置JavaScript代码
        function resetJavaScript() {
            if (confirm('确定要重置JavaScript代码吗？所有代码将被清除。')) {
                jsEditor.setValue('');
                // 更新相关的结构块
                updateSyncedStructureBlocks();
            }
        }
        
        // 保存JavaScript代码到本地存储
        function saveJavaScript() {
            const code = jsEditor.getValue();
            localStorage.setItem('savedJSCode', code);
            
            // 更新相关的结构块
            updateSyncedStructureBlocks();
            
            // 显示保存成功提示
            const originalText = saveJsBtn.innerHTML;
            saveJsBtn.innerHTML = '<i class="fa fa-check"></i> 已保存';
            saveJsBtn.disabled = true;
            
            setTimeout(() => {
                saveJsBtn.innerHTML = originalText;
                saveJsBtn.disabled = false;
            }, 1500);
        }
        
        // 复制JavaScript代码
        function copyJavaScript() {
            const code = jsEditor.getValue();
            if (code) {
                navigator.clipboard.writeText(code).then(() => {
                    const originalText = copyJsBtn.innerHTML;
                    copyJsBtn.innerHTML = '<i class="fa fa-check"></i> 已复制';
                    
                    setTimeout(() => {
                        copyJsBtn.innerHTML = originalText;
                    }, 1500);
                }).catch(err => {
                    console.error('无法复制文本: ', err);
                });
            }
        }
        
        // 插入JavaScript代码片段
        function insertJavaScriptSnippet(snippet) {
            // 获取光标位置
            const cursor = jsEditor.getCursor();
            // 在光标位置插入代码
            jsEditor.replaceRange(snippet, cursor);
            
            // 调整光标位置
            if (snippet.includes('\n')) {
                const lines = snippet.split('\n').length - 1;
                jsEditor.setCursor({
                    line: cursor.line + lines,
                    ch: snippet.split('\n').pop().length
                });
            } else {
                jsEditor.setCursor({
                    line: cursor.line,
                    ch: cursor.ch + snippet.length
                });
            }
            
            // 聚焦编辑器
            jsEditor.focus();
            
            // 更新相关的结构块
            updateSyncedStructureBlocks();
        }
        
        // HTML转义函数
        function escapeHtml(text) {
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // 防抖函数
        function debounce(func, wait) {
            let timeout;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }
        
        // 显示指定的内容区域
        function showSection(sectionId, activeBtn) {
            // 隐藏所有区域
            contentSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // 移除所有按钮的活跃状态
            document.querySelectorAll('.white-sidebar-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 显示选中的区域并激活对应的按钮
            document.getElementById(sectionId).classList.add('active');
            activeBtn.classList.add('active');
            
            // 如果切换到控件区域，更新预览
            if (sectionId === 'controls-section') {
                updateHtmlEditorFromElements();
            }
            
            // 如果切换到JS区域，确保编辑器获得焦点
            if (sectionId === 'js-section' && jsEditor) {
                jsEditor.focus();
            }
        }
        
        // 初始化样式表编辑器 - 默认为空
        function initStyleEditor() {
            // 清空编辑器，设置提示文本
            cssEditor.value = '';
        }
        
        // 重置CSS编辑器（清空）
        function resetCss() {
            if (confirm('确定要清空样式表吗？所有样式将被移除。')) {
                cssEditor.value = '';
                // 同时移除已应用的自定义样式
                const dynamicStyle = document.getElementById('dynamic-style');
                if (dynamicStyle) {
                    dynamicStyle.remove();
                }
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
            }
        }
        
        // 应用CSS更改
        function applyCss() {
            // 清除现有动态样式
            const existingStyle = document.getElementById('dynamic-style');
            if (existingStyle) {
                existingStyle.remove();
            }
            
            // 如果有CSS内容，创建新的样式元素并应用
            if (cssEditor.value.trim() !== '') {
                const style = document.createElement('style');
                style.id = 'dynamic-style';
                style.textContent = cssEditor.value;
                document.head.appendChild(style);
            }
            
            // 更新相关的结构块
            updateSyncedStructureBlocks();
            
            // 显示应用成功提示
            const originalText = applyCssBtn.innerHTML;
            applyCssBtn.innerHTML = '<i class="fa fa-check"></i> 已应用';
            applyCssBtn.disabled = true;
            
            setTimeout(() => {
                applyCssBtn.innerHTML = originalText;
                applyCssBtn.disabled = false;
            }, 1500);
        }
        
        // 从当前元素更新HTML编辑器内容
        function updateHtmlEditorFromElements() {
            if (addedElements.length === 0) {
                htmlEditor.value = '';
                return;
            }
            
            let allCode = '';
            addedElements.forEach((item, index) => {
                allCode += `${item.htmlCode}\n`;
            });
            
            htmlEditor.value = allCode.trim();
        }
        
        // 应用所有HTML代码更改到页面
        function applyAllHtmlChanges() {
            // 清除现有元素
            const draggableElements = dropArea.querySelectorAll('[data-draggable="true"]');
            draggableElements.forEach(el => el.remove());
            
            // 重置元素数据
            addedElements = [];
            elementCounter = 0;
            deselectElement();
            
            // 如果编辑器内容为空，则完成清理工作
            if (!htmlEditor.value.trim()) {
                // 更新元素代码汇总
                updateAllElementsCode();
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
                
                // 显示成功提示
                const originalText = applyAllHtmlBtn.innerHTML;
                applyAllHtmlBtn.innerHTML = '<i class="fa fa-check"></i> 已清空所有元素';
                
                setTimeout(() => {
                    applyAllHtmlBtn.innerHTML = originalText;
                }, 1500);
                
                return;
            }
            
            try {
                // 解析新代码
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlEditor.value;
                
                // 处理每个顶级元素
                const elements = tempDiv.children;
                for (let i = 0; i < elements.length; i++) {
                    const element = elements[i].cloneNode(true);
                    
                    // 确保元素有position:absolute样式
                    const currentStyle = element.getAttribute('style') || '';
                    if (!currentStyle.includes('position:')) {
                        element.setAttribute('style', `position: absolute; ${currentStyle}`);
                    }
                    
                    // 设置元素ID
                    const elementId = `element-${elementCounter}`;
                    element.setAttribute('data-id', elementId);
                    element.setAttribute('data-draggable', 'true');
                    
                    // 初始化拖拽功能
                    initElementDragging(element);
                    
                    // 添加到放置区域
                    dropArea.appendChild(element);
                    
                    // 保存元素信息
                    const htmlCode = element.outerHTML;
                    addedElements.push({
                        id: elementId,
                        element: element,
                        htmlCode: htmlCode,
                        type: element.tagName.toLowerCase()
                    });
                    
                    elementCounter++;
                }
                
                // 更新元素代码汇总
                updateAllElementsCode();
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
                
                // 显示成功提示
                const originalText = applyAllHtmlBtn.innerHTML;
                applyAllHtmlBtn.innerHTML = '<i class="fa fa-check"></i> 已应用';
                
                setTimeout(() => {
                    applyAllHtmlBtn.innerHTML = originalText;
                }, 1500);
                
            } catch (error) {
                alert(`应用失败: ${error.message}`);
            }
        }
        
        // 重置HTML代码
        function resetHtml() {
            if (confirm('确定要重置HTML代码吗？这将清除所有元素代码。')) {
                // 清除所有元素
                const draggableElements = dropArea.querySelectorAll('[data-draggable="true"]');
                draggableElements.forEach(el => el.remove());
                
                // 重置元素数据
                addedElements = [];
                elementCounter = 0;
                deselectElement();
                
                // 清空编辑器
                htmlEditor.value = '';
                updateAllElementsCode();
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
            }
        }
        
        // 复制HTML代码
        function copyHtmlCode() {
            const code = htmlEditor.value;
            if (code) {
                navigator.clipboard.writeText(code).then(() => {
                    const originalText = copyHtmlBtn.innerHTML;
                    copyHtmlBtn.innerHTML = '<i class="fa fa-check"></i> 已复制';
                    
                    setTimeout(() => {
                        copyHtmlBtn.innerHTML = originalText;
                    }, 1500);
                }).catch(err => {
                    console.error('无法复制文本: ', err);
                    alert('复制失败，请手动复制。');
                });
            }
        }
        
        // 添加HTML片段到编辑器
        function addHtmlSnippet(snippet) {
            // 获取光标位置
            const cursorPos = htmlEditor.selectionStart;
            const currentValue = htmlEditor.value;
            
            // 在光标位置插入新内容
            const newValue = 
                currentValue.substring(0, cursorPos) + 
                (currentValue ? '\n' : '') + snippet + 
                (currentValue.substring(cursorPos) ? '\n' : '') +
                currentValue.substring(cursorPos);
            
            // 更新编辑器内容
            htmlEditor.value = newValue;
            
            // 移动光标到新内容后面
            const newCursorPos = cursorPos + snippet.length + (currentValue ? 1 : 0);
            htmlEditor.focus();
            htmlEditor.setSelectionRange(newCursorPos, newCursorPos);
            
            // 更新相关的结构块
            updateSyncedStructureBlocks();
        }
        
        // 拖拽开始（从左侧控件库）
        function handleDragStart(e) {
            // 如果白色界面激活，则不允许拖拽
            if (whiteScreenActive) return;
            
            this.classList.add('dragging');
            draggedItem = this;
            e.dataTransfer.setData('text/plain', this.getAttribute('data-type'));
            setTimeout(() => {
                this.style.opacity = '0.4';
            }, 0);
        }
        
        // 拖拽结束（从左侧控件库）
        function handleDragEnd() {
            this.classList.remove('dragging');
            this.style.opacity = '1';
            dropArea.classList.remove('highlight');
            draggedItem = null;
        }
        
        // 拖拽经过放置区域
        function handleDragOver(e) {
            // 如果白色界面激活，则不允许放置
            if (whiteScreenActive) return;
            
            e.preventDefault();
        }
        
        // 进入放置区域
        function handleDragEnter(e) {
            // 如果白色界面激活，则不允许进入
            if (whiteScreenActive) return;
            
            e.preventDefault();
            this.classList.add('highlight');
            // 移除初始提示
            const initialHint = this.querySelector('.initial-hint');
            if (initialHint) {
                initialHint.remove();
            }
        }
        
        // 离开放置区域
        function handleDragLeave() {
            if (!this.contains(event.relatedTarget)) {
                this.classList.remove('highlight');
            }
        }
        
        // 在放置区域放下元素
        function handleDrop(e) {
            // 如果白色界面激活，则不允许放置
            if (whiteScreenActive) return;
            
            e.preventDefault();
            this.classList.remove('highlight');
            
            const type = e.dataTransfer.getData('text/plain');
            if (type && draggedItem) {
                // 获取相对于放置区域的坐标
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // 创建元素并设置位置
                const elementData = createNativeElement(type);
                if (elementData) {
                    const { element, htmlCode } = elementData;
                    
                    // 设置位置属性
                    element.style.left = `${x}px`;
                    element.style.top = `${y}px`;
                    element.setAttribute('data-draggable', 'true');
                    element.setAttribute('data-id', `element-${elementCounter}`);
                    
                    this.appendChild(element);
                    
                    // 添加拖拽功能
                    initElementDragging(element);
                    
                    // 存储元素信息
                    addedElements.push({
                        id: `element-${elementCounter}`,
                        element: element,
                        htmlCode: htmlCode,
                        type: type
                    });
                    
                    elementCounter++;
                    
                    // 更新所有元素代码汇总
                    updateAllElementsCode();
                    
                    // 如果白色界面打开且在控件标签页，更新编辑器
                    if (whiteScreenActive && document.getElementById('controls-section').classList.contains('active')) {
                        updateHtmlEditorFromElements();
                    }
                    
                    // 更新相关的结构块
                    updateSyncedStructureBlocks();
                    
                    // 自动选中新创建的元素
                    selectElement(element);
                }
            }
        }
        
        // 点击放置区域（用于选择元素）
        function handleDropAreaClick(e) {
            // 如果白色界面激活，则不允许点击
            if (whiteScreenActive) return;
            
            // 如果点击的是放置区域本身而非元素，则取消选择
            if (e.target === dropArea) {
                deselectElement();
            }
        }
        
        // 创建原生HTML元素并返回元素及其基础HTML代码
        function createNativeElement(type) {
            let element, htmlCode;
            const timestamp = Date.now();
            
            switch(type) {
                // 标题标签
                case 'h1':
                    element = document.createElement('h1');
                    element.textContent = 'H1大标题';
                    element.style.margin = '0';
                    htmlCode = `<h1 style="position: absolute;">H1大标题</h1>`;
                    break;
                    
                case 'h2':
                    element = document.createElement('h2');
                    element.textContent = 'H2二级标题';
                    element.style.margin = '0';
                    htmlCode = `<h2 style="position: absolute;">H2二级标题</h2>`;
                    break;
                    
                case 'h3':
                    element = document.createElement('h3');
                    element.textContent = 'H3三级标题';
                    element.style.margin = '0';
                    htmlCode = `<h3 style="position: absolute;">H3三级标题</h3>`;
                    break;
                    
                // 块级文本容器
                case 'p':
                    element = document.createElement('p');
                    element.textContent = '这是一段段落文本内容。';
                    element.style.margin = '0';
                    htmlCode = `<p style="position: absolute;">这是一段段落文本内容。</p>`;
                    break;
                    
                case 'blockquote':
                    element = document.createElement('blockquote');
                    element.textContent = '这是一段引用文本，通常用于引用其他来源的内容。';
                    element.style.margin = '0';
                    htmlCode = `<blockquote style="position: absolute;">这是一段引用文本，通常用于引用其他来源的内容。</blockquote>`;
                    break;
                    
                // 按钮控件
                case 'button':
                    element = document.createElement('button');
                    element.textContent = '普通按钮';
                    element.addEventListener('click', (e) => {
                        if (!isDragging && !whiteScreenActive) {
                            e.stopPropagation();
                            alert('普通按钮被点击了！');
                        }
                    });
                    htmlCode = `<button style="position: absolute;">普通按钮</button>`;
                    break;
                    
                case 'button-submit':
                    element = document.createElement('button');
                    element.type = 'submit';
                    element.textContent = '提交按钮';
                    element.addEventListener('click', (e) => {
                        if (!isDragging && !whiteScreenActive) {
                            e.stopPropagation();
                            alert('提交按钮被点击了！');
                        }
                    });
                    htmlCode = `<button type="submit" style="position: absolute;">提交按钮</button>`;
                    break;
                    
                // 输入控件
                case 'input-text':
                    element = document.createElement('input');
                    element.type = 'text';
                    element.placeholder = '文本输入';
                    element.addEventListener('click', (e) => {
                        if (!whiteScreenActive) e.stopPropagation();
                    });
                    htmlCode = `<input type="text" placeholder="文本输入" style="position: absolute;">`;
                    break;
                    
                case 'input-password':
                    element = document.createElement('input');
                    element.type = 'password';
                    element.placeholder = '密码输入';
                    element.addEventListener('click', (e) => {
                        if (!whiteScreenActive) e.stopPropagation();
                    });
                    htmlCode = `<input type="password" placeholder="密码输入" style="position: absolute;">`;
                    break;
                    
                case 'input-date':
                    element = document.createElement('input');
                    element.type = 'date';
                    element.addEventListener('click', (e) => {
                        if (!whiteScreenActive) e.stopPropagation();
                    });
                    htmlCode = `<input type="date" style="position: absolute;">`;
                    break;
                    
                // 基础选择控件
                case 'select':
                    element = document.createElement('select');
                    element.innerHTML = `
                        <option value="">请选择</option>
                        <option value="1">选项1</option>
                        <option value="2">选项2</option>
                        <option value="3">选项3</option>
                    `;
                    element.addEventListener('click', (e) => {
                        if (!whiteScreenActive) e.stopPropagation();
                    });
                    htmlCode = `<select style="position: absolute;">
  <option value="">请选择</option>
  <option value="1">选项1</option>
  <option value="2">选项2</option>
  <option value="3">选项3</option>
</select>`;
                    break;
                    
                // 文本区域
                case 'textarea':
                    element = document.createElement('textarea');
                    element.rows = 3;
                    element.cols = 30;
                    element.placeholder = '多行文本输入';
                    element.addEventListener('click', (e) => {
                        if (!whiteScreenActive) e.stopPropagation();
                    });
                    htmlCode = `<textarea rows="3" placeholder="多行文本输入" style="position: absolute;"></textarea>`;
                    break;
                    
                case 'label':
                    element = document.createElement('label');
                    element.textContent = '这是一个标签文本';
                    htmlCode = `<label style="position: absolute;">这是一个标签文本</label>`;
                    break;
                    
                // 媒体元素
                case 'img':
                    element = document.createElement('img');
                    element.src = 'https://picsum.photos/200/150?random=' + timestamp;
                    element.alt = '示例图片';
                    htmlCode = `<img src="image.jpg" alt="示例图片" style="position: absolute;">`;
                    break;
                    
                case 'video':
                    element = document.createElement('video');
                    element.controls = true;
                    element.width = 320;
                    element.innerHTML = '<source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">您的浏览器不支持视频标签。';
                    htmlCode = `<video controls width="320" style="position: absolute;">
  <source src="video.mp4" type="video/mp4">
</video>`;
                    break;
                    
                case 'audio':
                    element = document.createElement('audio');
                    element.controls = true;
                    element.innerHTML = '<source src="https://www.w3schools.com/html/horse.ogg" type="audio/ogg">您的浏览器不支持音频标签。';
                    htmlCode = `<audio controls style="position: absolute;">
  <source src="audio.mp3" type="audio/mpeg">
</audio>`;
                    break;
                    
                default:
                    return null;
            }
            
            return { element, htmlCode };
        }
        
        // 初始化元素拖拽功能
        function initElementDragging(element) {
            element.addEventListener('mousedown', startDrag);
            
            function startDrag(e) {
                // 如果白色界面激活，则不允许拖拽元素
                if (whiteScreenActive) return;
                
                // 防止拖动时选中文本
                e.preventDefault();
                
                // 设置拖拽状态
                isDragging = true;
                activeElement = element;
                activeElement.classList.add('selected', 'dragging');
                
                // 选中当前元素
                selectElement(element);
                
                // 计算初始位置和偏移量
                const rect = activeElement.getBoundingClientRect();
                initialX = e.clientX;
                initialY = e.clientY;
                offsetX = initialX - rect.left;
                offsetY = initialY - rect.top;
                
                // 添加事件监听
                document.addEventListener('mousemove', dragElement);
                document.addEventListener('mouseup', stopDrag);
            }
            
            function dragElement(e) {
                if (activeElement && isDragging && !whiteScreenActive) {
                    e.preventDefault();
                    
                    // 计算新位置
                    const rect = dropArea.getBoundingClientRect();
                    const newX = e.clientX - rect.left - offsetX;
                    const newY = e.clientY - rect.top - offsetY;
                    
                    // 确保位置不为负
                    const finalX = Math.max(0, newX);
                    const finalY = Math.max(0, newY);
                    
                    // 更新元素位置
                    activeElement.style.left = `${finalX}px`;
                    activeElement.style.top = `${finalY}px`;
                    
                    // 更新属性面板中的位置值
                    if (selectedElement === activeElement) {
                        posXInput.value = Math.round(finalX);
                        posYInput.value = Math.round(finalY);
                        
                        // 更新元素代码编辑器
                        updateElementCodeEditor(activeElement);
                    }
                    
                    // 更新元素信息中的HTML代码
                    const elementId = activeElement.getAttribute('data-id');
                    const elementInfo = addedElements.find(item => item.id === elementId);
                    if (elementInfo) {
                        // 更新元素信息中的HTML代码
                        updateElementCodeEditor(activeElement);
                        elementInfo.htmlCode = elementCodeEditor.value;
                        
                        // 更新所有元素代码汇总
                        updateAllElementsCode();
                        
                        // 如果白色界面打开且在控件标签页，更新编辑器
                        if (whiteScreenActive && document.getElementById('controls-section').classList.contains('active')) {
                            updateHtmlEditorFromElements();
                        }
                        
                        // 更新相关的结构块
                        updateSyncedStructureBlocks();
                    }
                }
            }
            
            function stopDrag() {
                // 重置拖拽状态
                isDragging = false;
                if (activeElement) {
                    activeElement.classList.remove('dragging');
                }
                
                // 移除事件监听
                document.removeEventListener('mousemove', dragElement);
                document.removeEventListener('mouseup', stopDrag);
                activeElement = null;
            }
        }
        
        // 选择元素
        function selectElement(element) {
            // 如果白色界面激活，则不允许选择元素
            if (whiteScreenActive) return;
            
            // 取消之前选中的元素
            deselectElement();
            
            // 设置新的选中元素
            selectedElement = element;
            element.classList.add('selected');
            
            // 获取元素信息
            const elementId = element.getAttribute('data-id');
            selectedElementInfo = addedElements.find(item => item.id === elementId);
            
            // 更新属性面板
            updatePropertyPanel();
            
            // 更新元素代码编辑器
            updateElementCodeEditor(element);
            
            // 显示属性内容，隐藏空提示
            propertyEmpty.style.display = 'none';
            propertyContent.style.display = 'block';
        }
        
        // 取消选择元素
        function deselectElement() {
            if (selectedElement) {
                selectedElement.classList.remove('selected');
                selectedElement = null;
                selectedElementInfo = null;
            }
            
            // 隐藏属性内容，显示空提示
            propertyContent.style.display = 'none';
            propertyEmpty.style.display = 'flex';
        }
        
        // 更新属性面板
        function updatePropertyPanel() {
            if (!selectedElement) return;
            
            // 获取元素位置
            const rect = selectedElement.getBoundingClientRect();
            const dropRect = dropArea.getBoundingClientRect();
            const x = Math.round(rect.left - dropRect.left);
            const y = Math.round(rect.top - dropRect.top);
            
            // 获取元素类型
            const tagName = selectedElement.tagName.toLowerCase();
            
            // 更新输入框值
            posXInput.value = x;
            posYInput.value = y;
            elementTypeInput.value = tagName;
        }
        
        // 更新元素代码编辑器
        function updateElementCodeEditor(element) {
            if (!element || !selectedElementInfo) return;
            
            // 获取元素位置
            const x = parseInt(element.style.left) || 0;
            const y = parseInt(element.style.top) || 0;
            
            // 获取基础HTML代码并更新位置信息
            let code = selectedElementInfo.htmlCode;
            
            // 替换或添加位置样式
            if (code.includes('style="')) {
                // 已存在样式属性，更新位置信息
                if (code.includes('left:')) {
                    code = code.replace(/left:\s*[\d.]+px;/, `left: ${x}px;`);
                } else {
                    code = code.replace('style="', `style="left: ${x}px; `);
                }
                
                if (code.includes('top:')) {
                    code = code.replace(/top:\s*[\d.]+px;/, `top: ${y}px;`);
                } else {
                    // 找到样式中的最后一个分号或引号，插入top属性
                    const styleMatch = code.match(/style="[^"]+"/);
                    if (styleMatch && styleMatch[0]) {
                        const styleContent = styleMatch[0].slice(7, -1);
                        const newStyleContent = styleContent + `top: ${y}px;`;
                        code = code.replace(styleMatch[0], `style="${newStyleContent}"`);
                    }
                }
            } else {
                // 不存在样式属性，添加样式
                const tagEnd = code.startsWith('</') ? '>' : '>';
                const tagEndIndex = code.indexOf(tagEnd);
                if (tagEndIndex !== -1) {
                    code = code.substring(0, tagEndIndex) + 
                           ` style="position: absolute; left: ${x}px; top: ${y}px;"` + 
                           code.substring(tagEndIndex);
                }
            }
            
            // 更新代码编辑器
            elementCodeEditor.value = code;
            // 清除错误提示
            codeError.classList.remove('active');
        }
        
        // 应用元素代码修改
        function applyElementCodeChanges() {
            if (!selectedElement || !selectedElementInfo) return;
            
            const newCode = elementCodeEditor.value.trim();
            if (!newCode) {
                showCodeError('代码不能为空');
                return;
            }
            
            try {
                // 创建临时容器解析HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = newCode;
                
                // 确保只解析一个顶级元素
                if (tempDiv.children.length !== 1) {
                    throw new Error('代码必须包含且仅包含一个元素');
                }
                
                const newElement = tempDiv.firstElementChild;
                
                // 保留原位置信息
                const originalLeft = selectedElement.style.left;
                const originalTop = selectedElement.style.top;
                
                // 保留原ID
                const originalId = selectedElement.getAttribute('data-id');
                
                // 初始化新元素的拖拽功能
                initElementDragging(newElement);
                
                // 设置新元素的属性
                newElement.setAttribute('data-draggable', 'true');
                newElement.setAttribute('data-id', originalId);
                newElement.style.left = originalLeft;
                newElement.style.top = originalTop;
                
                // 替换旧元素
                selectedElement.parentNode.replaceChild(newElement, selectedElement);
                
                // 更新元素信息
                selectedElementInfo.element = newElement;
                selectedElementInfo.htmlCode = newCode;
                selectedElement = newElement;
                
                // 更新属性面板
                updatePropertyPanel();
                
                // 更新所有元素代码汇总
                updateAllElementsCode();
                
                // 如果白色界面打开且在控件标签页，更新编辑器
                if (whiteScreenActive && document.getElementById('controls-section').classList.contains('active')) {
                    updateHtmlEditorFromElements();
                }
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
                
                // 显示成功提示
                const originalText = applyElementCodeBtn.innerHTML;
                applyElementCodeBtn.innerHTML = '<i class="fa fa-check"></i> 已更新';
                
                setTimeout(() => {
                    applyElementCodeBtn.innerHTML = originalText;
                }, 1500);
                
                // 清除错误提示
                codeError.classList.remove('active');
                
            } catch (error) {
                showCodeError(error.message);
            }
        }
        
        // 显示代码错误
        function showCodeError(message) {
            codeError.textContent = `错误: ${message}`;
            codeError.classList.add('active');
        }
        
        // 复制元素代码
        function copyElementCode() {
            if (!selectedElement) return;
            
            const code = elementCodeEditor.value;
            if (code) {
                navigator.clipboard.writeText(code).then(() => {
                    const originalText = copyElementCodeBtn.innerHTML;
                    copyElementCodeBtn.innerHTML = '<i class="fa fa-check"></i> 已复制';
                    
                    setTimeout(() => {
                        copyElementCodeBtn.innerHTML = originalText;
                    }, 1500);
                }).catch(err => {
                    console.error('无法复制文本: ', err);
                    alert('复制失败，请手动复制。');
                });
            }
        }
        
        // 更新所有元素代码汇总
        function updateAllElementsCode() {
            if (addedElements.length === 0) {
                allElementsCodeDisplay.textContent = '暂无元素';
                return;
            }
            
            let allCode = '';
            addedElements.forEach((item, index) => {
                allCode += `${item.htmlCode}\n`;
            });
            
            allElementsCodeDisplay.textContent = allCode;
        }
        
        // 通过属性面板更新元素位置
        function updateElementPosition() {
            // 如果白色界面激活，则不允许更新位置
            if (whiteScreenActive) return;
            
            if (!selectedElement) return;
            
            // 获取输入框值
            const x = parseInt(posXInput.value) || 0;
            const y = parseInt(posYInput.value) || 0;
            
            // 确保值为非负数
            const finalX = Math.max(0, x);
            const finalY = Math.max(0, y);
            
            // 更新元素位置
            selectedElement.style.left = `${finalX}px`;
            selectedElement.style.top = `${finalY}px`;
            
            // 修正输入框值（如果为负数）
            posXInput.value = finalX;
            posYInput.value = finalY;
            
            // 更新元素代码编辑器
            updateElementCodeEditor(selectedElement);
            
            // 更新元素信息中的HTML代码
            if (selectedElementInfo) {
                selectedElementInfo.htmlCode = elementCodeEditor.value;
                
                // 更新所有元素代码汇总
                updateAllElementsCode();
                
                // 如果白色界面打开且在控件标签页，更新编辑器
                if (whiteScreenActive && document.getElementById('controls-section').classList.contains('active')) {
                    updateHtmlEditorFromElements();
                }
                
                // 更新相关的结构块
                updateSyncedStructureBlocks();
            }
        }
        
        // 切换白色界面显示状态
        function toggleWhiteScreen() {
            whiteScreenActive = !whiteScreenActive;
            
            if (whiteScreenActive) {
                whiteScreen.classList.add('active');
                // 隐藏选中状态
                if (selectedElement) {
                    selectedElement.classList.remove('selected');
                }
                // 默认显示控件编辑区域并加载所有元素代码
                showSection('controls-section', controlsBtn);
            } else {
                whiteScreen.classList.remove('active');
                // 恢复选中状态
                if (selectedElement) {
                    selectedElement.classList.add('selected');
                }
            }
        }
        
        // 处理键盘事件
        function handleKeyDown(e) {
            // F8切换侧边栏显示/隐藏
            if (e.key === 'F8') {
                e.preventDefault();
                document.body.classList.toggle('sidebars-collapsed');
            }
            
            // F9切换白色界面
            if (e.key === 'F9') {
                e.preventDefault();
                toggleWhiteScreen();
            }
        }
        
        // 打开块类型选择弹窗
        function openBlockTypeModal() {
            blockTypeModal.classList.add('active');
        }
        
        // 关闭块类型选择弹窗
        function closeBlockTypeModal() {
            blockTypeModal.classList.remove('active');
        }
        
        // 添加结构块
        function addStructureBlock(type) {
            const blockId = `structure-block-${structureBlockCounter}`;
            let title, icon, initialContent = '';
            
            // 根据块类型设置标题、图标和初始内容
            switch(type) {
                case 'code':
                    title = '代码块';
                    icon = 'fa-code';
                    initialContent = '// 在此处编写代码\n';
                    break;
                case 'stylesheet':
                    title = '样式表块';
                    icon = 'fa-css3';
                    initialContent = cssEditor.value;
                    break;
                case 'controls':
                    title = '控件块';
                    icon = 'fa-th-large';
                    initialContent = htmlEditor.value;
                    break;
                case 'js':
                    title = 'JavaScript块';
                    icon = 'fa-code';
                    initialContent = jsEditor ? jsEditor.getValue() : '';
                    break;
                default:
                    return;
            }
            
            // 创建块元素
            const block = document.createElement('div');
            block.className = 'structure-block';
            block.id = blockId;
            block.setAttribute('data-type', type);
            
            // 设置块内容
            block.innerHTML = `
                <div class="structure-block-header">
                    <div class="structure-block-title">
                        <i class="fa ${icon}"></i>
                        <span>${title}</span>
                    </div>
                    <div class="structure-block-actions">
                        <button class="block-action-btn copy-block" title="复制代码">
                            <i class="fa fa-copy"></i>
                        </button>
                        <button class="block-action-btn delete-block" title="删除块">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div class="structure-block-content">
                    <div class="code-editor-container">
                        <div class="code-content">
                            <textarea class="code-input block-code-editor" spellcheck="false">${escapeHtml(initialContent)}</textarea>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加到容器
            structureBlocksContainer.appendChild(block);
            
            // 创建CodeMirror编辑器
            const textarea = block.querySelector('.block-code-editor');
            const editor = CodeMirror.fromTextArea(textarea, {
                mode: type === 'stylesheet' ? 'css' : 
                      type === 'js' ? 'javascript' : 
                      type === 'controls' ? 'htmlmixed' : 'htmlmixed',
                theme: 'dracula',
                lineNumbers: true,
                autoCloseTags: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                indentWithTabs: false,
                lineWrapping: true,
                height: '300px'
            });
            
            // 为非代码类型的块添加代码变更事件监听
            if (type !== 'code') {
                editor.on('change', debounce(() => {
                    // 不允许修改同步类型的块
                    editor.setValue(getSourceContentForBlockType(type));
                }, 500));
            }
            
            // 添加块点击展开/折叠功能
            const header = block.querySelector('.structure-block-header');
            header.addEventListener('click', () => {
                block.classList.toggle('expanded');
            });
            
            // 添加复制功能
            const copyBtn = block.querySelector('.copy-block');
            copyBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                const code = editor.getValue();
                if (code) {
                    navigator.clipboard.writeText(code).then(() => {
                        const originalIcon = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<i class="fa fa-check"></i>';
                        
                        setTimeout(() => {
                            copyBtn.innerHTML = originalIcon;
                        }, 1500);
                    }).catch(err => {
                        console.error('无法复制文本: ', err);
                    });
                }
            });
            
            // 添加删除功能
            const deleteBtn = block.querySelector('.delete-block');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (confirm('确定要删除这个块吗？')) {
                    block.remove();
                    // 从结构块数组中移除
                    structureBlocks = structureBlocks.filter(b => b.id !== blockId);
                }
            });
            
            // 默认展开新块
            block.classList.add('expanded');
            
            // 保存块信息
            structureBlocks.push({
                id: blockId,
                type: type,
                element: block,
                editor: editor
            });
            
            structureBlockCounter++;
        }
        
        // 获取块类型对应的源内容
        function getSourceContentForBlockType(type) {
            switch(type) {
                case 'stylesheet':
                    return cssEditor.value;
                case 'controls':
                    return htmlEditor.value;
                case 'js':
                    return jsEditor ? jsEditor.getValue() : '';
                default:
                    return '';
            }
        }
        
        // 更新同步类型的结构块
        function updateSyncedStructureBlocks() {
            structureBlocks.forEach(block => {
                // 只更新非代码类型的块
                if (block.type !== 'code') {
                    const sourceContent = getSourceContentForBlockType(block.type);
                    if (block.editor.getValue() !== sourceContent) {
                        block.editor.setValue(sourceContent);
                    }
                }
            });
        }
        
        // 构建项目 - 按顺序组装所有块的内容
        function buildProject() {
            if (structureBlocks.length === 0) {
                alert('请先添加块再进行构建');
                return;
            }
            
            // 获取所有块的内容并按顺序拼接
            let buildResult = '';
            
            // 获取DOM中的块顺序（按在容器中的出现顺序）
            const blockElements = structureBlocksContainer.querySelectorAll('.structure-block');
            
            blockElements.forEach((blockEl, index) => {
                const blockId = blockEl.id;
                const block = structureBlocks.find(b => b.id === blockId);
                
                if (block) {
                    // 添加块内容
                    buildResult += block.editor.getValue();
                    
                    // 不是最后一个块则添加换行
                    if (index < blockElements.length - 1) {
                        buildResult += '\n\n';
                    }
                }
            });
            
            // 显示构建结果弹窗
            buildResultCode.value = buildResult;
            
            // 生成默认文件名（时间戳精确到秒）
            const now = new Date();
            const timestamp = now.getFullYear() + 
                            padZero(now.getMonth() + 1) + 
                            padZero(now.getDate()) + 
                            padZero(now.getHours()) + 
                            padZero(now.getMinutes()) + 
                            padZero(now.getSeconds());
            filenameInput.value = '';
            filenameInput.setAttribute('data-default', timestamp);
            
            // 显示弹窗
            buildResultModal.classList.add('active');
        }
        
        // 辅助函数：数字补零
        function padZero(num) {
            return num < 10 ? '0' + num : num;
        }
        
        // 关闭构建结果弹窗
        function closeBuildModal() {
            buildResultModal.classList.remove('active');
        }
        
        // 下载构建结果
        function downloadBuildResult() {
            // 获取文件名，如未输入则使用默认时间戳
            let filename = filenameInput.value.trim() || filenameInput.getAttribute('data-default');
            // 确保文件名以.html结尾
            if (!filename.endsWith('.html')) {
                filename += '.html';
            }
            
            // 创建Blob对象
            const blob = new Blob([buildResultCode.value], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            // 创建下载链接
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                closeBuildModal();
            }, 100);
        }
        
        // 初始化应用
        function initApp() {
            initEventListeners();
            initStyleEditor();
            initJavaScriptEditor();
            updateHtmlEditorFromElements();
            updateAllElementsCode();
            
            // 添加样式表变更监听
            cssEditor.addEventListener('input', debounce(updateSyncedStructureBlocks, 500));
            
            // 添加HTML编辑器变更监听
            htmlEditor.addEventListener('input', debounce(updateSyncedStructureBlocks, 500));
            
            // 添加JS编辑器变更监听
            if (jsEditor) {
                jsEditor.on('change', debounce(updateSyncedStructureBlocks, 500));
            }
        }
        
        // 启动应用
        initApp();
    </script>
</body>
</html>

